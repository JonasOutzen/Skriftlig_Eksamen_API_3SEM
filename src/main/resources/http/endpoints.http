@baseUrl = {{baseUrl}}
@authToken = {{authToken}}
# Manual override (optional): uncomment and paste a JWT if you want to force a specific token
# @authToken = eyJhbGciOiJIUzI1NiJ9...

####################################################################
### SECURITY
####################################################################

### Health check (open)
GET {{baseUrl}}/auth/healthcheck

### Test (open)
GET {{baseUrl}}/auth/test

### Register (returns token). If user exists, skip.
# @name register
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "testpass"
}

> {%
  try {
    const data = JSON.parse(response.body);
    if (data.token) {
      client.global.set("authToken", data.token);
      client.log("Saved authToken from REGISTER: " + data.token);
    } else {
      client.log("No token field in register response");
    }
  } catch (e) {
    client.log("Register parse error: " + e);
  }
%}

### Login (returns token) â€” run this to refresh token
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "testpass"
}

> {%
  try {
    const data = JSON.parse(response.body);
    if (data.token) {
      client.global.set("authToken", data.token);
      client.log("Saved authToken from LOGIN: " + data.token);
    } else {
      client.log("No token field in login response");
    }
  } catch (e) {
    client.log("Login parse error: " + e);
  }
%}

### Add ADMIN role to current user (requires USER)
# After this, run LOGIN again and add the new token to
#    "baseUrl": "http://localhost:7070/api",
#    "authToken":

POST {{baseUrl}}/auth/user/addrole
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "role": "ADMIN"
}

### Login again to get a token that includes ADMIN
### Set token in client-env
# @name loginAdmin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "jonas",
  "password": "jonaspw"
}

> {%
  try {
    const data = JSON.parse(response.body);
    if (data.token) {
      client.global.set("authToken", data.token);
      client.log("Saved ADMIN authToken from LOGIN: " + data.token);
    } else {
      client.log("No token field in login response");
    }
  } catch (e) {
    client.log("Login parse error: " + e);
  }
%}

### USER protected demo (needs USER)
GET {{baseUrl}}/protected/user_demo
Authorization: Bearer {{authToken}}

### ADMIN protected demo (needs ADMIN)
GET {{baseUrl}}/protected/admin_demo
Authorization: Bearer {{authToken}}

####################################################################
### Candidates
####################################################################

### Create Candidate (ADMIN)
POST {{baseUrl}}/candidates
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "candidateName": "Endpoint Candidate",
  "candidatePhone": "+45 11 88 22 33",
  "candidateEducation": "BSc Computer Science"
}

### Get all candidates (open)
GET {{baseUrl}}/candidates

### Get candidate by ID (open)
GET {{baseUrl}}/candidates/1

### Update candidate (ADMIN)
PUT {{baseUrl}}/candidates/1
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "candidateName": "Endpoint Candidate Updated",
  "candidatePhone": "+45 11 88 22 33",
  "candidateEducation": "BSc Computer Science"
}

### Delete candidate (ADMIN)
DELETE {{baseUrl}}/candidate/1
Authorization: Bearer {{authToken}}

### Attach skill on candidate
### Should put a skill on noSkillLarry
PUT {{baseUrl}}/candidates/3/skills/2
Authorization: Bearer {{authToken}}

### Get candidate with details
GET {{baseUrl}}/candidates/3/details
Authorization: Bearer {{authToken}}

### GET candidates from skillCategory
GET {{baseUrl}}/candidates?category=DB
Authorization: Bearer {{authToken}}

### Get analystic avg
GET {{baseUrl}}/reports/candidates/top-by-popularity
Authorization: Bearer {{authToken}}

